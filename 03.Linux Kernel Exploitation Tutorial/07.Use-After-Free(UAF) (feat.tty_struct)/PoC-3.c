#include <stdio.h>
#include <stdlib.h>
#include <fcntl.h>
#include <unistd.h>
#include <errno.h>
#include <string.h>
#include <stdint.h>
#include "chardev.h"

#define DEVICE_FILE_NAME "/dev/chardev0"   
#define HEAP_SIZE 736

int main(){

    int fd1,fd_tty,i,j;
    char info[HEAP_SIZE];

    if ((fd1 = open(DEVICE_FILE_NAME, O_RDWR)) < 0){
        printf("Cannot open /dev/chardev0. Try again later.\n");
    }

    ioctl(fd1, KMALLOC, HEAP_SIZE);
    ioctl(fd1, KFREE);

    if ((fd_tty = open("/dev/ptmx", O_RDWR|O_NOCTTY)) < 0){
        printf("Cannot open /dev/chardev0. Try again later.\n");
    }

    memset(info, 0, HEAP_SIZE);
    read(fd1, info, HEAP_SIZE - 1);
 
    for (i = 0; i < 46; i++)
    {
        for (j = 0; j < 16; j++) printf("%02x ", info[i*16+j] & 0xff);
        printf(" | ");
        for (j = 0; j < 16; j++) printf("%c", info[i*16+j] & 0xff);
        printf("\n");
    }

    if (close(fd1) != 0){
        printf("Cannot close.\n");
    }

    if (close(fd_tty) != 0){
        printf("Cannot close.\n");
    }
    return 0;
}
